# Changelog

0.1.5及以后所有显著的变更都会记录在本文件中。

## [0.1.8] - 2026-02-25

### Changed

- 性能优化：优化了`To`和`Cast`的实现方式，降低大部分场景下查缓存的开销，性能更接近`GetCaster`
- 规则调整：结构体内存布局完全一致要求“字段名相同或 `json` tag 相同”，改为“字段名相同，优先使用 `cast/json` tag 里定义的名称，不区分大小写与下划线”
- 规则调整：移除特殊规则“`string` 与其他 `[]T` / `[N]T` 互转时，`string` 被视为 `[]byte` 处理”，改为仅支持`string`与`[]byte` / `[N]byte` / `[]rune` / `[N]rune` 互转
- 规则调整：切片转数组指针零拷贝条件为“元素内存布局相同且切片`容量`不小于数组长度”，改为“元素内存布局相同且切片`长度`不小于数组长度”，与go默认做法保持一致
- 规则调整：接口类型内存布局完全一致条件由“方法集相同”改为“都为空接口，或接口类型相同”，因为非空接口的itab里有接口类型指针，直接强转不安全
- 规则调整：函数转换允许目标函数返回值额外多出一个error，当最后一个返回值为error，且入参/出参类型转换错误时，会返回转换错误，并把其他返回值改为零值，否则忽略转换错误
- go版本调整：最低兼容版本由`1.20`降低至`1.18`

### Fixed

- 修复 bug：`json` tag 解析未考虑复杂情况
- 修复 bug：嵌套结构体未考虑环形依赖
- 修复 bug：数组相关转换可能出现panic
- 修复 bug：函数转换未考虑变长参数

### Added

- 结构体新增`cast` tag，优先级比`json` tag 更高，格式为`` `cast:"name[,options...]"` ``，options目前仅支持`required`。也支持`` `cast:"-"` ``，表示跳过该字段
  > 注意：不会跳过`json:"-"`的字段

## [0.1.7] - 2025-11-24

### Fixed

- 修复 bug：结构体转换可能通过`json tag`匹配到未导出字段

### Added

- 新增`func To[T any](from any) (T, error)`，调用更方便，但是会多一层拆箱
- 支持嵌套结构体

## [0.1.6] - 2025-11-13

### Fixed

- 修复 bug：某些特定情况下，目标类型为结构体时，未能匹配的字段不为零值。
- 修复 bug：在高版本 go（如go1.25）中，某些情况下会 panic

### Changed

- 结构体转换规则调整：目标类型为非空结构体时，移除“至少成功匹配一个字段”的限制，与 README 保持一致

## [0.1.5] - 2025-11-11

### Fixed

- 修复 bug：基于基类的新类型转为`any`类型时，类型被错误的修改为基类类型。
  例如：`json.Number`转为`any`时，类型会被改为`string`。

- 修复 bug：深拷贝非空接口时，会无限递归
